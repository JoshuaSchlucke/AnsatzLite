module tests/problems_maxcut

import test
import src/qaoa/types
import src/problems/graph
import src/problems/maxcut
import src/handlers/statevector

// Simple numeric helper for approximate comparisons.

def abs(x: Double): Double =
  if (x < 0.0) (0.0 - x) else x

def assertApprox(obtained: Double, expected: Double) =
  assertEqual(obtained, expected) { (x, y) => abs(x - y) <= 0.000000001 } { x => x.show }


def main() = mainSuite("MaxCut problem") {
  test("cutValue bit patterns") {
    val g = tinyGraph()
    assertEqual(cutValue(0, g), 0.0)
    assertEqual(cutValue(1, g), 1.0)
    assertEqual(cutValue(2, g), 1.0)
    assertEqual(cutValue(3, g), 0.0)
  }

  test("executeMaxCut on uniform state") {
    val g = tinyGraph()
    val a = ansatz([layer(0.0, 0.0)])
    val value = withStatevector { executeMaxCut(a, g) }
    assertApprox(value, 0.5)
  }

  test("weighted edge expectation") {
    val g = Graph(2, [Edge(0, 1, 2.0)])
    val a = ansatz([layer(0.0, 0.0)])
    val value = withStatevector { executeMaxCut(a, g) }
    assertApprox(value, 1.0)
  }
}
