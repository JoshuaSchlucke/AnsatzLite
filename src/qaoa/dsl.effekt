module src/qaoa/dsl

import src/qaoa/types
import src/qaoa/effects
import effekt

// Build and execute a QAOA program using effects.

def bitAt(bits: Int, index: Int): Int =
  bitwiseAnd(bitwiseShr(bits, index), 1)

def execute(a: Ansatz, qubits: Int): Double / {prepare, cost, mixer, expect} = {
  do prepare(qubits)
  a.layers.foreach { l =>
    do cost(l.gamma)
    do mixer(l.beta)
  }
  do expect { value =>
    if (bitAt(value, 0) == 0) 1.0 else -1.0
  }
}
